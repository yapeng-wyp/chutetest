jQuery(document).ready(function(r){r("#tb-manage-connection").dialog({title:"Templateberg Manage Connection",dialogClass:"wp-dialog",autoOpen:!1,draggable:!1,width:"auto",modal:!0,resizable:!1,closeOnEscape:!0,position:{my:"center",at:"center",of:window},open:function(){r(".ui-widget-overlay,#tb-connect-btn,#tb-cancel-btn,#tb-send-question-btn").bind("click",function(){r("#tb-manage-connection").dialog("close")})}}),r("#tb-open-manage-connection").click(function(e){e.preventDefault(),r("#tb-manage-connection").dialog("open")});let e=window.location.search;e.match("connecting")&&!e.match("isPopup")&&setTimeout(function(){window.location.href=templateberg.admin_url},3e3),r(".tb-accordion__header a").click(function(e){e.preventDefault();let t=r(this),a=t.attr("href");r(".tb-accordion__bodywrap").addClass("hidden"),r(a).removeClass("hidden")});let s;function c(){r.ajax({type:"GET",url:templateberg.restUrl+"templateberg/v1/is_connected",data:{},beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",templateberg.restNonce)}}).done(function(e){e&&(s&&s.close(),location.reload())}).fail(function(e,t,a){console.log(e+" :: "+t+" :: "+a)}).always(function(){})}r("#tb-connect-btn").click(function(e){var t,a,n,o,l;e.preventDefault(),t=r(this).attr("href"),a="Templateberg",n=650,o=500,l=(screen.width-n)/2,e=(screen.height-o)/4,t+="&isPopup=yes",s=window.open(t,a,"resizable=yes, width="+n+", height="+o+", top="+e+", left="+l),r.ajax({type:"POST",url:ajaxurl,data:{action:"templateberg_gutentor",security:templateberg.nonce},success:function(e){console.log(e);setInterval(c,2e3)},error:function(e,t,a){console.log(a)}})});let n=r(".tb-purchase__data");function a(e){r.ajax({type:"POST",url:templateberg.restUrl+"templateberg/v1/purchases",data:{purchases:e},beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",templateberg.restNonce)}}).done(function(e){n.html(e)}).fail(function(e,t,a){n.html("Error! Problem on your server. Refresh and try again!"),console.log(e+" :: "+t+" :: "+a)}).always(function(){})}r(".tb-data__purchase_sync").click(function(e){e.preventDefault(),templateberg&&templateberg.account||alert(templateberg.msg.not_connected);let t=r(this);r.ajax({type:"GET",url:templateberg.purchase_url,beforeSend:function(e){t.addClass("t-loading")}}).done(function(e){a("object"==typeof e?e:"reset")}).fail(function(e,t,a){n.html(templateberg.msg.failed),console.log(e+" :: "+t+" :: "+a)}).always(function(){t.removeClass("t-loading")})});let o=r(".tb-templates__list");function l(e){r.ajax({type:"GET",url:templateberg.restUrl+"templateberg/v1/free_templates",data:{freeTemplates:e},beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",templateberg.restNonce)}}).done(function(e){o.html(e)}).fail(function(e,t,a){o.html("Error! Problem on your server. Refresh and try again!"),console.log(e+" :: "+t+" :: "+a)}).always(function(){})}function t(e=!1,t=1){let n=r(".tb-gutenberg-templates");let a={paged:t};e&&(a.reset=!0),r.ajax({type:"GET",url:templateberg.restUrl+"templateberg/v1/gutenberg_templates",data:a,beforeSend:function(e){r("body").addClass("tb-template-popup"),r("body").addClass("tb-template-popup-loading"),n.show(),r("#tb-list__popup_loader").show(),e.setRequestHeader("X-WP-Nonce",templateberg.restNonce)}}).done(function(e){location.reload()}).fail(function(e,t,a){n.html("Error! Problem on your server. Refresh and try again!"),console.log(e+" :: "+t+" :: "+a)}).always(function(){location.reload()})}function i(e=!1,t=1){let n=r(".tb-themes-template-kits");let a={paged:t};e&&(a.reset=!0),r.ajax({type:"GET",url:templateberg.restUrl+"templateberg/v1/theme_templates",data:a,beforeSend:function(e){r("body").addClass("tb-template-popup"),r("body").addClass("tb-template-popup-loading"),n.show(),r("#tb-list__popup_loader").show(),e.setRequestHeader("X-WP-Nonce",templateberg.restNonce)}}).done(function(e){location.reload()}).fail(function(e,t,a){n.html("Error! Problem on your server. Refresh and try again!"),console.log(e+" :: "+t+" :: "+a)}).always(function(){location.reload()})}function p(t,a){let n=window.location.href,e=new RegExp("[?|&]"+t+"=[0-9a-zA-Z_+-|.,;]*");if(e.test(n)){let e=new RegExp("[?&]"+t+"=([^&#]*)");var o=e.exec(n)[0].charAt(0);n=n.replace(e,o+t+"="+a)}else{t=t+"="+a;n.indexOf("?")||(n+="?"),-1<n.indexOf("#")?(a=n.split("#"),n=a[0]+"&"+t+(a[1]?"#"+a[1]:"")):n+="&"+t}window.history.pushState(null,document.title,n)}function u(e){let t=window.location.search.substring(1),a=t.split("&"),n,o;for(o=0;o<a.length;o++)if((n=a[o].split("="))[0]===e)return n[1],decodeURIComponent(n[1]);return!1}function d(){return!!(u("type")&&"selected"===u("type")&&u("theme")&&u("slug"))}function m(e=!1,t=1){let n=r(".tb-themes-template-kits");let a={paged:t};e&&(a.reset=!0),d()&&(a.theme={},a.theme.stylesheet=u("slug"),a.theme.template=u("slug"),a.theme.author=u("slug"),p("selected-theme","loaded")),console.log(a),r.ajax({type:"GET",url:templateberg.restUrl+"templateberg/v1/current_theme_templates",data:a,beforeSend:function(e){r("body").addClass("tb-template-popup"),r("body").addClass("tb-template-popup-loading"),n.show(),r("#tb-list__popup_loader").show(),function(e,t=1){let a={paged:t};e&&(a.reset=!0),r.ajax({type:"GET",url:templateberg.restUrl+"templateberg/v1/current_theme_purchased_templates",data:a,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",templateberg.restNonce)}}).done(function(e){}).fail(function(e,t,a){holder.html("Error! Problem on your server. Refresh and try again!"),console.log(e+" :: "+t+" :: "+a)}).always(function(){})}(!0),e.setRequestHeader("X-WP-Nonce",templateberg.restNonce)}}).done(function(e){setTimeout(function(){location.reload()},1e3)}).fail(function(e,t,a){n.html("Error! Problem on your server. Refresh and try again!"),console.log(e+" :: "+t+" :: "+a)}).always(function(){})}r(".tb-data__free_sync").click(function(e){e.preventDefault(),templateberg&&templateberg.account||alert(templateberg.msg.not_connected);e={account:templateberg.account};let t=r(this);r.ajax({type:"GET",url:templateberg.free_templates_url,data:e,beforeSend:function(e){t.addClass("t-loading")}}).done(function(e){l("object"==typeof e?e:"reset")}).fail(function(e,t,a){o.html("Error! Fail to sync."),console.log(e+" :: "+t+" :: "+a)}).always(function(){t.removeClass("t-loading")})}),r(".tb-gutenberg-templates-refresh").click(function(e){e.preventDefault(),t(!0)}),r(".tb-themes-template-kits-refresh").click(function(e){e.preventDefault(),i(!0)}),r(".tb-list__theme_type").click(function(e){console.log("hi"),e.preventDefault();let t=r(this);"available"===t.data("type")?p("type","available"):"purchase"===t.data("type")?p("type","purchase"):p("type","current"),location.reload()});let b=!1;function f(){let e=new URL(location);e.searchParams.delete("selected-theme"),e.searchParams.delete("theme"),e.searchParams.delete("slug"),history.replaceState(null,null,e)}r(".tb-current-themes-template-kits-refresh").click(function(e){e.preventDefault(),!(e=r(this))||b||(b=e,b.append('<span class="tb-update dashicons dashicons-update"></span>'),b.attr("disabled",!0),b.closest(".ai-item").addClass("tb-action-importing")),m(!0)}),setTimeout(function(){let e=window.location.href,t=new RegExp("[?|&]reset=[0-9a-zA-Z_+-|.,;]*");if(t.test(e)){let e=new URL(location);e.searchParams.delete("reset"),e.searchParams.delete("from"),history.replaceState(null,null,e)}},1),"templateberg-gutenberg-templates"===u("page")?templateberg.has_templates.gutenberg_templates?r(".tb-gutenberg-templates").show():t():"templateberg-themes-template-kits"===u("page")&&("available"===u("type")?(templateberg.has_templates.available_themes?r(".tb-themes-template-kits").show():i(),f()):d()?"loaded"!==u("selected-theme")?m(!0):r(".tb-themes-template-kits").show():(templateberg.has_templates.current_theme||templateberg.has_templates.current_theme_nothing?r(".tb-themes-template-kits").show():m(!0),f()))});